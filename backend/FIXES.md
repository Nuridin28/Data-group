# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –û—à–∏–±–∫–∞ "['channel_encoded'] not in index"

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `detect_suspicious_transactions` –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞, —Ç–∞–∫ –∫–∞–∫ –∫–æ–ª–æ–Ω–∫–∞ `channel_encoded` —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏ –º–æ–¥–µ–ª–∏, –Ω–æ –Ω–µ –±—ã–ª–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –Ω–æ–≤–æ–º dataframe.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∫–æ–ª–æ–Ω–æ–∫ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
- `channel_encoded` —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ –ª–µ—Ç—É –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `LabelEncoder` –¥–ª—è channel
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å fallback –Ω–∞ rule-based detection

### 2. –û—à–∏–±–∫–∞ OpenAI API Key

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π `OPENAI_API_KEY` –≤—ã–∑—ã–≤–∞–ª –æ—à–∏–±–∫–∏ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ vectorstore.

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å CSV fallback
- Vectorstore –∏—Å–ø–æ–ª—å–∑—É–µ—Ç lazy initialization
- –û—à–∏–±–∫–∏ API –∫–ª—é—á–∞ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç —Å–µ—Ä–≤–µ—Ä

## üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `backend/services/prediction_service.py`
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `_train_suspicious_model()` - –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–ª–æ–Ω–æ–∫
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `detect_suspicious_transactions()` - —Å–æ–∑–¥–∞–Ω–∏–µ `channel_encoded` –Ω–∞ –ª–µ—Ç—É
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `channel_encoder` –≤ `__init__`
  - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫:
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ `/api/upload`
- ‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –±–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ OpenAI API –∫–ª—é—á–∞
- ‚úÖ Fallback –Ω–∞ rule-based detection –µ—Å–ª–∏ ML –º–æ–¥–µ–ª—å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
